# CLAUDE.md - onotebook Development Guide

## Project Overview

onotebook is an open-source RAG knowledge assistant. Read `docs/app_spec.txt` for full specification.

**Structure:**
- `frontend/` - Next.js app (see frontend/CLAUDE.md)
- `backend/` - FastAPI server (see backend/CLAUDE.md)

## Progress Tracking

- `docs/feature_list.json` - Test cases tracking implementation progress
- `claude-progress.txt` - Session summaries and notes for continuity

**feature_list.json rules:**
- Only modify the `"passes"` field (false → true)
- Never remove, edit, or reorder test cases
- Only mark passing after verification with Playwright

## Session Workflow

### Starting a Session
1. Run `pwd` and `ls` to orient yourself
2. Read `claude-progress.txt` for context from previous sessions
3. Read `docs/feature_list.json` to see current progress
4. Check `git log --oneline -10` for recent changes
5. Start dev servers if not running
6. Verify 1-2 existing features still work before new work

### During Development
- Work on ONE feature at a time
- Test thoroughly before marking passes: true
- Commit after each completed feature
- Keep the app in a working state

### Ending a Session
1. Commit all working code
2. Update `claude-progress.txt` with:
   - What you accomplished
   - What should be worked on next
   - Any issues or blockers discovered
   - Current progress (e.g., "23/150 tests passing")
3. Ensure no uncommitted changes
4. Leave code in working state

## Operational Rules

### Package Management
- **Python:** Use `uv add <package>` - never edit pyproject.toml dependencies manually
- **JavaScript:** Use `bun add <package>` - never edit package.json dependencies manually
- **Never** edit lock files (uv.lock, bun.lockb) manually

### Database
- **Development phase:** Use SQLModel's `SQLModel.metadata.create_all()` 
- **Skip Alembic** for now - we'll add migrations before production
- Do not create alembic version files manually

### Git
- Commit messages: descriptive, no trailer ("Generated by Claude", etc.)
- Good: `Add notebook CRUD endpoints`
- Bad: `Update files` or `Changes`
- Only commit working code

### Files to Never Edit Manually
- Lock files (uv.lock, bun.lockb)
- node_modules/, __pycache__/
- Generated files
- .env files (use .env.example for templates)

## Implementation Style

### Code Quality
- Write it properly the first time — there is no "refine later"
- Use clear names that describe intent (no abbreviations)
- Functions do one thing; if it needs a comment to explain, split it
- Handle errors explicitly — no silent failures

### Avoid Over-Engineering
- No premature abstractions — write concrete code until duplication is obvious
- No "just in case" flexibility — solve the current problem only
- No wrapper functions that just call another function
- No config files for things that could be constants

### Avoid Under-Engineering
- Validate all user input at API boundaries
- Handle all errors with meaningful messages to the user
- No `any` types in TypeScript, no untyped `def` in Python
- Cancel in-flight requests when components unmount

### Structure
- Max 2-3 levels of nesting; refactor if deeper
- Delete unused code immediately — no TODOs, no commented-out blocks
- One file per component/route/model — no mega-files

## Quality Assurance

### Type Safety (Primary Bug Prevention)
- **TypeScript:** Strict mode enabled, no `any` types
- **Python:** Type hints on all functions, validate with pyright if needed
- Type errors must be fixed, not ignored

### Feature Verification (Playwright MCP)
- Test through the actual UI, not just API calls
- Take screenshots at key steps as evidence
- Interact like a real user: click, type, navigate
- Verify both functionality AND visual appearance

### Verification Checklist
- [ ] Feature works via UI interaction
- [ ] No console errors in browser
- [ ] Visual appearance matches design
- [ ] Loading and error states handled
- [ ] Screenshot captured as evidence

### What We Skip
- Unit tests (type system catches most issues)
- Integration tests (E2E verification is sufficient)
- pytest / Vitest test suites (maintenance overhead)
- TDD approach (doesn't work well with AI development)

### What NOT to Do
- Don't test only with curl (insufficient for UI features)
- Don't use JavaScript evaluation to bypass UI
- Don't mark tests passing without browser verification
- Don't skip visual checks

## Development Commands

```bash
# Backend
cd backend
uv add <package>              # Add Python package
uv run fastapi dev src/backend/main.py  # Start dev server

# Frontend  
cd frontend
bun add <package>             # Add JS package
bun run dev                   # Start dev server

# Both servers needed for full testing
```

## When to Ask

- Before adding new dependencies
- Before making architectural changes
- Before changing project structure
- When requirements are unclear
- When you encounter blockers